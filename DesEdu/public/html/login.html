<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>시간표 페이지</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
    }

    .header {
      background-color: #ffffff;
      padding: 15px 30px;
      border-bottom: 1px solid #ddd;
      display: flex;
      align-items: center;
    }

    .logo {
      margin-right: 30px;
    }

    .logo img {
      height: 50px;
      cursor: pointer;
    }

    .dropdown {
      position: relative;
    }

    .dropdown-btn {
      background-color: #333;
      color: white;
      padding: 10px 16px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: white;
      min-width: 180px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .dropdown-content a {
      display: block;
      padding: 10px;
      color: black;
      text-decoration: none;
      border-bottom: 1px solid #eee;
    }

    .dropdown-content a:hover {
      background-color: #f0f0f0;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .main {
      display: flex;
      padding: 30px;
      gap: 40px;
      align-items: flex-start;
    }

    .subject-box {
      flex: 1;
      max-height: 700px;
      overflow-y: auto;         /* ✅ 스크롤 가능하게 */
      display: flex;
      flex-direction: column;   /* ✅ 세로 정렬로 변경 */
      gap: 20px;                /* ✅ 박스 사이 간격 */
      background-color: #ffffff;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .subject-rect {
      width: 320px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 14px;
      background-color: #fafafa;
      border: 2px solid #666;
      border-radius: 8px;
      box-shadow: inset 0 0 5px #ddd;
    }

    .subject-name {
      font-size: 18px;
      font-weight: bold;
      margin: 0;
    }

    .separator {
      width: 100%;
      height: 1px;
      background-color: #ccc;
    }

    .subject-btn-container {
      display: flex;
      gap: 10px;
      width: 100%;
      justify-content: space-between;
    }

    .subject-btn {
      flex: 1;
      padding: 12px 0;
      font-size: 13px;
      border: 1px solid #000;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-notice {
      background-color: #007bff;
      color: #333;
      font-weight: bold;
    }

    .btn-homework {
      background-color: #28a745;
      color: #333;
      font-weight: bold;
    }

    .btn-resource {
      background-color: #ffc107;
      color: #333;
      font-weight: bold;
    }

    .subject-btn:hover {
      opacity: 0.9;
    }

    .timetable {
      flex: 1;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
    }

    th {
      background-color: #f0f0f0;
    }

    td {
      height: 60px;
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">
      <a href="login.html">
        <img src="/images/logo.jpg" alt="DesEDU 로고" />
      </a>
    </div>

    <div class="dropdown">
      <button class="dropdown-btn">메뉴</button>
      <div class="dropdown-content">
        <a href="syllabus.html">강의계획서 조회</a>
        <a href="courseRegistration.html">수강 신청</a>
        <a href="grade.html">성적 조회</a>
        <a href="gradeInput.html">성적 입력</a>
        <a href="myInfo.html">내 정보 수정</a>
        <a href="board.html">자유 게시판</a>
        <a href="futurePlan.html">진로 설계</a>
        <li><hr></li> <!-- 구분선 -->
        <li><a href="/api/auth/logout">로그아웃</a></li>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="subject-box">
      <div class="subject-rect">
        <p class="subject-name">과목명</p>
        <div class="separator"></div>
        <div class="subject-btn-container">
          <button class="subject-btn btn-notice" onclick="location.href='notice.html'">강의 공지사항</button>
          <button class="subject-btn btn-homework" onclick="location.href='homework.html'">과제</button>
          <button class="subject-btn btn-resource" onclick="location.href='info.html'">자료실</button>
        </div>
      </div>
    </div>

    <div class="timetable">
      <table>
        <thead>
          <tr>
            <th>교시</th>
            <th>월</th>
            <th>화</th>
            <th>수</th>
            <th>목</th>
            <th>금</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1</td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><td>2</td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><td>3</td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><td>4</td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><td>5</td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><td>6</td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><td>7</td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><td>8</td><td></td><td></td><td></td><td></td><td></td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <script>
    const dayMap = { '월': 1, '화': 2, '수': 3, '목': 4, '금': 5 };

    function parseTimeSlot(timeStr) {
      const slots = timeStr.split(',').map(s => s.trim());
      const result = [];

      slots.forEach(slot => {
        const [day, periodStr] = slot.split(' ');
        const col = dayMap[day];

        if (!col || !periodStr) return;

        if (periodStr.includes('~')) {
          const [start, end] = periodStr.split('~').map(Number);
          for (let row = start; row <= end; row++) {
            result.push({ col, row });
          }
        } else {
          result.push({ col, row: Number(periodStr) });
        }
      });
      return result;
    }

    function getColorForSubject(subject) {
      // 과목 이름 기준 해시로 색상 고정
      const hash = [...subject].reduce((acc, ch) => acc + ch.charCodeAt(0), 0);
      const hue = hash % 360;
      return `hsl(${hue}, 60%, 85%)`; // 연한 파스텔 계열
    }

    function fillTimetable(courses) {
      courses.forEach(course => {
        const positions = parseTimeSlot(course.time);
        const bgColor = getColorForSubject(course.subject);
        const printed = new Set(); // 각 요일별 첫 셀만 과목명 표시

        positions.forEach(({ col, row }) => {
          const cell = document.querySelector(`.timetable tbody tr:nth-child(${row}) td:nth-child(${col + 1})`);
          if (cell) {
            cell.style.backgroundColor = bgColor;
            const dayKey = `col${col}`; // 요일 기준 키
            if (!printed.has(dayKey)) {
              cell.textContent = course.subject;
              cell.style.fontWeight = 'bold';
              printed.add(dayKey);
            }
          }
        });
      });
    }

    function createSubjectBox(subjectName, professor) {
      const container = document.querySelector('.subject-box');
      const rect = document.createElement('div');
      rect.className = 'subject-rect';
      rect.innerHTML = `
       <p class="subject-name">${subjectName} - ${professor} 교수</p>
        <div class="separator"></div>
        <div class="subject-btn-container">
          <button class="subject-btn btn-notice" onclick="goToPage('${subjectName.replace(/'/g, "\\'")}', 'notice')">강의 공지사항</button>
          <button class="subject-btn btn-homework" onclick="goToPage('${subjectName.replace(/'/g, "\\'")}', 'homework')">과제</button>
          <button class="subject-btn btn-resource" onclick="goToPage('${subjectName.replace(/'/g, "\\'")}', 'info')">자료실</button>
        </div>
      `;
      container.appendChild(rect);
    }

    function goToPage(subject, type) {
      const url = `${type}.html?subject=${encodeURIComponent(subject)}`;
      window.location.href = url;
    }

    // ✅ 서버에서 사용자별 신청 과목 가져와서 시간표 + 박스 생성
    fetch('/api/registered-courses')
    .then(res => res.json())
    .then(data => {
      // subject-box 내부 비우고 (기존 고정된 '과목명' 삭제)
      document.querySelector('.subject-box').innerHTML = '';
      data.forEach(course => {
        createSubjectBox(course.subject, course.professor);
      });
      fillTimetable(data); // 시간표도 동시에 채움
    })
    .catch(err => console.error('수강 과목 불러오기 오류:', err));
    </script>
</body>
</html>



